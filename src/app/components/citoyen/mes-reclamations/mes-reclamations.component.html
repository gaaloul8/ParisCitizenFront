<!-- Navbar Citoyen -->
<nav class="navbar-citoyen">
  <div class="navbar-container">
    <a routerLink="/citoyen/dashboard" class="logo-citoyen">ParisCitizen</a>
    <ul class="nav-links-citoyen">
      <li><a routerLink="/citoyen/projets" routerLinkActive="active">Projets</a></li>
      <li><a routerLink="/citoyen/etablissements" routerLinkActive="active">√âtablissements</a></li>
      <li><a routerLink="/citoyen/mes-reclamations" routerLinkActive="active">Mes R√©clamations</a></li>
      <li><a routerLink="/citoyen/chatbot" routerLinkActive="active">Chatbot</a></li>
      <li><a routerLink="/citoyen/profil" routerLinkActive="active">Profil</a></li>
      <li><a href="#" (click)="logout()">D√©connexion</a></li>
    </ul>
  </div>
</nav>

<div class="container">
  <div class="page-header">
    <h1>Mes r√©clamations</h1>
    <p>Consultez l'√©tat de vos signalements et cr√©ez de nouvelles r√©clamations</p>
    <button class="btn btn-primary" (click)="showNewReclamationForm = !showNewReclamationForm">
      üìù Nouvelle r√©clamation
    </button>
  </div>

  <!-- Formulaire de nouvelle r√©clamation -->
  <div *ngIf="showNewReclamationForm" class="new-reclamation-form">
    <div class="form-container">
      <h3>Cr√©er une nouvelle r√©clamation</h3>
      <form (ngSubmit)="submitNewReclamation()" #reclamationForm="ngForm">
        <div class="form-group">
          <label for="sujet">Sujet *</label>
          <input 
            type="text" 
            id="sujet" 
            name="sujet" 
            class="form-control" 
            [(ngModel)]="newReclamation.sujet" 
            #sujet="ngModel"
            required
            [class.error]="sujet.invalid && sujet.touched">
          <span class="error-message" *ngIf="sujet.invalid && sujet.touched">
            Le sujet est obligatoire
          </span>
        </div>

        <div class="form-group">
          <label for="type">Type de probl√®me *</label>
          <select 
            id="type" 
            name="type" 
            class="form-select" 
            [(ngModel)]="newReclamation.type" 
            #type="ngModel"
            required
            [class.error]="type.invalid && type.touched">
            <option value="">S√©lectionnez un type</option>
            <option value="voirie">Voirie</option>
            <option value="eclairage">√âclairage public</option>
            <option value="dechets">D√©chets</option>
            <option value="espaces_verts">Espaces verts</option>
            <option value="transport">Transport</option>
            <option value="autre">Autre</option>
          </select>
          <span class="error-message" *ngIf="type.invalid && type.touched">
            Veuillez s√©lectionner un type
          </span>
        </div>

        <div class="form-group">
          <label for="localisation">Localisation *</label>
          <input 
            type="text" 
            id="localisation" 
            name="localisation" 
            class="form-control" 
            [(ngModel)]="newReclamation.localisation" 
            #localisation="ngModel"
            required
            placeholder="Adresse ou lieu pr√©cis"
            [class.error]="localisation.invalid && localisation.touched">
          <span class="error-message" *ngIf="localisation.invalid && localisation.touched">
            La localisation est obligatoire
          </span>
        </div>

        <div class="form-group">
          <label for="description">Description *</label>
          <textarea 
            id="description" 
            name="description" 
            class="form-control" 
            [(ngModel)]="newReclamation.description" 
            #description="ngModel"
            required
            rows="4"
            placeholder="D√©crivez le probl√®me en d√©tail..."
            [class.error]="description.invalid && description.touched"></textarea>
          <span class="error-message" *ngIf="description.invalid && description.touched">
            La description est obligatoire
          </span>
        </div>

        <div class="form-group">
          <label for="priorite">Priorit√©</label>
          <select 
            id="priorite" 
            name="priorite" 
            class="form-select" 
            [(ngModel)]="newReclamation.priorite">
            <option value="basse">Basse</option>
            <option value="moyenne">Moyenne</option>
            <option value="haute">Haute</option>
          </select>
        </div>

        <div class="form-actions">
          <button 
            type="submit" 
            class="btn btn-primary" 
            [disabled]="reclamationForm.invalid || isSubmitting">
            <span *ngIf="isSubmitting">Envoi en cours...</span>
            <span *ngIf="!isSubmitting">Envoyer la r√©clamation</span>
          </button>
          <button 
            type="button" 
            class="btn btn-secondary" 
            (click)="cancelNewReclamation()">
            Annuler
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Filtres -->
  <div class="filters-section">
    <div class="filter-group">
      <label for="statutFilter">Filtrer par statut :</label>
      <select id="statutFilter" [(ngModel)]="statutFilter" (change)="filterReclamations()" class="form-select">
        <option value="">Tous les statuts</option>
        <option value="en_attente">En attente</option>
        <option value="en_cours">En cours</option>
        <option value="traitee">Trait√©e</option>
        <option value="rejetee">Rejet√©e</option>
      </select>
    </div>
  </div>

  <!-- Tableau des r√©clamations -->
  <div class="reclamations-table-container">
    <table class="reclamations-table">
      <thead>
        <tr>
          <th>Sujet</th>
          <th>Type</th>
          <th>Description</th>
          <th>Localisation</th>
          <th>Date</th>
          <th>Statut</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let reclamation of filteredReclamations" class="reclamation-row">
          <td class="reclamation-sujet">{{ reclamation.sujet }}</td>
          <td class="reclamation-type">
            <span class="type-badge" [ngClass]="'type-' + reclamation.type">
              {{ getTypeLabel(reclamation.type) }}
            </span>
          </td>
          <td class="reclamation-description">{{ reclamation.description }}</td>
          <td class="reclamation-localisation">{{ reclamation.localisation }}</td>
          <td class="reclamation-date">{{ formatDate(reclamation.dateCreation) }}</td>
          <td class="reclamation-statut">
            <span class="statut-badge" [ngClass]="getStatutClass(reclamation.statut)">
              {{ getStatutLabel(reclamation.statut) }}
            </span>
          </td>
          <td class="reclamation-actions">
            <button class="btn btn-sm btn-info" (click)="viewReclamation(reclamation)">
              üëÅÔ∏è Voir
            </button>
            <button class="btn btn-sm btn-primary" *ngIf="reclamation.statut === 'en_attente'">Modifier</button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Message si aucune r√©clamation -->
  <div *ngIf="filteredReclamations.length === 0" class="no-reclamations">
    <div class="no-reclamations-content">
      <h3>Aucune r√©clamation trouv√©e</h3>
      <p>Aucune r√©clamation ne correspond √† vos crit√®res de filtrage.</p>
      <button class="btn btn-primary" (click)="clearFilters()">Voir toutes les r√©clamations</button>
    </div>
  </div>

  <!-- Modal de d√©tail de la r√©clamation -->
  <div *ngIf="selectedReclamation" class="modal-overlay" (click)="closeModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>D√©tail de la r√©clamation #{{ selectedReclamation.id }}</h3>
        <button class="btn-close" (click)="closeModal()">&times;</button>
      </div>
      
      <div class="modal-body">
        <div class="detail-section">
          <h4>üìã Informations g√©n√©rales</h4>
          <div class="detail-grid">
            <div class="detail-item">
              <label>Sujet :</label>
              <span>{{ selectedReclamation.sujet }}</span>
            </div>
            <div class="detail-item">
              <label>Type :</label>
              <span class="type-badge" [ngClass]="'type-' + selectedReclamation.type">
                {{ getTypeLabel(selectedReclamation.type) }}
              </span>
            </div>
            <div class="detail-item">
              <label>Priorit√© :</label>
              <span class="priorite-badge" [ngClass]="'priorite-' + selectedReclamation.priorite">
                {{ getPrioriteLabel(selectedReclamation.priorite) }}
              </span>
            </div>
            <div class="detail-item">
              <label>Statut :</label>
              <span class="statut-badge" [ngClass]="getStatutClass(selectedReclamation.statut)">
                {{ getStatutLabel(selectedReclamation.statut) }}
              </span>
            </div>
          </div>
        </div>

        <div class="detail-section">
          <h4>üìç Localisation</h4>
          <div class="detail-item">
            <label>Adresse :</label>
            <span>{{ selectedReclamation.localisation }}</span>
          </div>
        </div>

        <div class="detail-section">
          <h4>üìù Description</h4>
          <div class="detail-item">
            <p>{{ selectedReclamation.description }}</p>
          </div>
        </div>

        <div class="detail-section">
          <h4>üìÖ Dates</h4>
          <div class="detail-grid">
            <div class="detail-item">
              <label>Date de cr√©ation :</label>
              <span>{{ formatDate(selectedReclamation.dateCreation) }}</span>
            </div>
            <div class="detail-item" *ngIf="selectedReclamation.dateTraitement">
              <label>Date de traitement :</label>
              <span>{{ formatDate(selectedReclamation.dateTraitement) }}</span>
            </div>
          </div>
        </div>

        <div class="detail-section" *ngIf="selectedReclamation.commentaires">
          <h4>üí¨ Commentaires</h4>
          <div class="detail-item">
            <p>{{ selectedReclamation.commentaires }}</p>
          </div>
        </div>
      </div>
      
      <div class="modal-footer">
        <button class="btn btn-secondary" (click)="closeModal()">Fermer</button>
      </div>
    </div>
  </div>
</div>
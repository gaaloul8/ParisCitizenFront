<!-- Navbar Citoyen -->
<nav class="navbar-citoyen">
  <div class="navbar-container">
    <a routerLink="/citoyen/dashboard" class="logo-citoyen">ParisCitizen</a>
    <ul class="nav-links-citoyen">
      <li><a routerLink="/citoyen/projets" routerLinkActive="active">Projets</a></li>
      <li><a routerLink="/citoyen/etablissements" routerLinkActive="active">Ã‰tablissements</a></li>
      <li><a routerLink="/citoyen/mes-reclamations" routerLinkActive="active">Mes RÃ©clamations</a></li>
      <li><a routerLink="/citoyen/chatbot" routerLinkActive="active">Chatbot</a></li>
      <li><a routerLink="/citoyen/profil" routerLinkActive="active">Profil</a></li>
      <li><a href="#" (click)="logout()">DÃ©connexion</a></li>
    </ul>
  </div>
</nav>

<div class="container">
  <div class="page-header">
    <h1>Projets de votre quartier</h1>
    <p>DÃ©couvrez et participez aux projets sociaux de votre arrondissement</p>
  </div>

  <!-- Filtres -->
  <div class="filters-section">
    <div class="filter-group">
      <label for="statutFilter">Filtrer par statut :</label>
      <select id="statutFilter" [(ngModel)]="statutFilter" (change)="filterProjects()" class="form-select">
        <option value="">Tous les statuts</option>
        <option value="ACTIF">En cours</option>
        <option value="PLANIFIE">PlanifiÃ©</option>
        <option value="TERMINE">TerminÃ©</option>
        <option value="BROUILLON">Brouillon</option>
      </select>
    </div>
  </div>

  <!-- Liste des projets -->
  <div class="projects-grid">
    <div *ngFor="let projet of filteredProjects" class="project-card">
      <div class="project-header">
        <h3>{{ projet.titre }}</h3>
        <span class="project-status" [ngClass]="'status-' + projet.statut">
          {{ getStatutLabel(projet.statut) }}
        </span>
      </div>
      
      <div class="project-content">
        <p class="project-description">{{ projet.description }}</p>
        
        <div class="project-details">
          <div class="detail-item">
            <span class="detail-label">ğŸ“… PÃ©riode :</span>
            <span class="detail-value">{{ formatDate(projet.dateDebut) }} - {{ formatDate(projet.dateFin) }}</span>
          </div>
          
          <div class="detail-item">
            <span class="detail-label">ğŸ‘¤ Responsable :</span>
            <span class="detail-value">{{ projet.responsable }}</span>
          </div>
          
          <div class="detail-item">
            <span class="detail-label">ğŸ’° Budget :</span>
            <span class="detail-value">{{ projet.budget | number }} â‚¬</span>
          </div>
          
          <div class="detail-item">
            <span class="detail-label">ğŸ‘¥ Participants :</span>
            <span class="detail-value">{{ projet.participants }} personnes</span>
          </div>
        </div>
      </div>
      
      <div class="project-actions">
        <button class="btn btn-secondary" (click)="openProjectDetails(projet)">
          Plus d'infos
        </button>
      </div>
    </div>
  </div>

  <!-- Message si aucun projet -->
  <div *ngIf="filteredProjects.length === 0" class="no-projects">
    <div class="no-projects-content">
      <h3>Aucun projet trouvÃ©</h3>
      <p>Aucun projet ne correspond Ã  vos critÃ¨res de filtrage.</p>
      <button class="btn btn-primary" (click)="clearFilters()">Voir tous les projets</button>
    </div>
  </div>
</div>

<!-- Modal de dÃ©tails du projet -->
<div *ngIf="showProjectDetailsModal" class="modal-overlay" (click)="closeProjectDetailsModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>{{ selectedProjet?.titre }}</h3>
      <button class="btn-close" (click)="closeProjectDetailsModal()">&times;</button>
    </div>
    
    <div class="modal-body">
      <div class="project-details-section">
        <div class="detail-section">
          <h3>ğŸ“‹ Description</h3>
          <p>{{ selectedProjet?.description }}</p>
        </div>
        
        <div class="detail-section">
          <h3>ğŸ“… PÃ©riode</h3>
          <p>{{ formatDate(selectedProjet?.dateDebut) }} - {{ formatDate(selectedProjet?.dateFin) }}</p>
        </div>
        
        <div class="detail-section">
          <h3>ğŸ‘¤ Responsable</h3>
          <p>{{ selectedProjet?.responsable }}</p>
        </div>
        
        <div class="detail-section">
          <h3>ğŸ’° Budget</h3>
          <p>{{ selectedProjet?.budget | number }} â‚¬</p>
        </div>
        
        <div class="detail-section">
          <h3>ğŸ‘¥ Participants actuels</h3>
          <p>{{ selectedProjet?.participants }} personnes</p>
        </div>
        
        <div class="detail-section" *ngIf="selectedProjet?.arrondissement">
          <h3>ğŸ˜ï¸ Arrondissement</h3>
          <p>{{ selectedProjet?.arrondissement }}</p>
        </div>
        
        <div class="detail-section" *ngIf="selectedProjet?.image">
          <h3>ğŸ–¼ï¸ Image</h3>
          <p>{{ selectedProjet?.image }}</p>
        </div>
      </div>
    </div>
    
    <div class="modal-footer">
      <button 
        class="btn btn-primary" 
        *ngIf="selectedProjet && (selectedProjet.statut === 'ACTIF' || selectedProjet.statut === 'PLANIFIE') && !isParticipatingInProject(selectedProjet.id)"
        (click)="participerDirectement(selectedProjet)"
        [disabled]="participationLoading">
        <span *ngIf="participationLoading">Participation...</span>
        <span *ngIf="!participationLoading">Participer</span>
      </button>
      <button 
        class="btn btn-danger" 
        *ngIf="selectedProjet && (selectedProjet.statut === 'ACTIF' || selectedProjet.statut === 'PLANIFIE') && isParticipatingInProject(selectedProjet.id)"
        (click)="annulerParticipationDirectement(selectedProjet)"
        [disabled]="participationLoading">
        <span *ngIf="participationLoading">Annulation...</span>
        <span *ngIf="!participationLoading">Annuler participation</span>
      </button>
      <button class="btn btn-secondary" (click)="closeProjectDetailsModal()">Fermer</button>
    </div>
  </div>
</div>

<!-- Modal Overlay -->
<div class="modal-overlay" *ngIf="isOpen" (click)="onBackdropClick($event)">
  <div class="modal-container" (click)="$event.stopPropagation()">
    
    <!-- Modal Header -->
    <div class="modal-header">
      <div class="modal-title">
        <span class="modal-icon">
          <ng-container [ngSwitch]="type">
            <span *ngSwitchCase="'citoyen'">ğŸ‘¤</span>
            <span *ngSwitchCase="'agent'">ğŸ‘¥</span>
            <span *ngSwitchCase="'municipalite'">ğŸ›ï¸</span>
          </ng-container>
        </span>
        <h2>
          <ng-container [ngSwitch]="type">
            <span *ngSwitchCase="'citoyen'">DÃ©tails du Citoyen</span>
            <span *ngSwitchCase="'agent'">DÃ©tails de l'Agent</span>
            <span *ngSwitchCase="'municipalite'">DÃ©tails de la MunicipalitÃ©</span>
          </ng-container>
        </h2>
      </div>
      <button class="close-btn" (click)="onClose()">
        <span>Ã—</span>
      </button>
    </div>

    <!-- Modal Content -->
    <div class="modal-content">
      
      <!-- Citoyen Details -->
      <div *ngIf="type === 'citoyen' && getCitoyenData()" class="detail-section">
        <div class="detail-card">
          <div class="detail-header">
            <div class="avatar">
              <span>{{ getCitoyenData()!.prenom.charAt(0) }}{{ getCitoyenData()!.nom.charAt(0) }}</span>
            </div>
            <div class="header-info">
              <h3>{{ getCitoyenData()!.prenom }} {{ getCitoyenData()!.nom }}</h3>
              <p class="subtitle">{{ getCitoyenData()!.commune }}</p>
              <span class="statut-badge" [ngClass]="getStatutClass(getCitoyenData()!.statut)">
                {{ getStatutLabel(getCitoyenData()!.statut) }}
              </span>
            </div>
          </div>
          
          <div class="detail-grid">
            <div class="detail-item">
              <div class="detail-label">ğŸ“§ Email</div>
              <div class="detail-value">{{ getCitoyenData()!.email }}</div>
            </div>
            
            <div class="detail-item">
              <div class="detail-label">ğŸ‚ Ã‚ge</div>
              <div class="detail-value">{{ getCitoyenData()!.age }} ans</div>
            </div>
            
            <div class="detail-item">
              <div class="detail-label">ğŸ“… Date d'inscription</div>
              <div class="detail-value">{{ formatDate(getCitoyenData()!.dateInscription) }}</div>
            </div>
            
            <div class="detail-item">
              <div class="detail-label">ğŸ•’ DerniÃ¨re activitÃ©</div>
              <div class="detail-value">{{ formatDate(getCitoyenData()!.derniereActivite) }}</div>
            </div>
          </div>
          
          <div class="stats-section">
            <h4>ğŸ“Š Statistiques</h4>
            <div class="stats-grid">
              <div class="stat-card">
                <div class="stat-icon">ğŸ“</div>
                <div class="stat-content">
                  <div class="stat-number">{{ getCitoyenData()!.nombreReclamations }}</div>
                  <div class="stat-label">RÃ©clamations</div>
                </div>
                <div class="stat-badge" [ngClass]="getBadgeClass(getCitoyenData()!.nombreReclamations)">
                  {{ getCitoyenData()!.nombreReclamations }}
                </div>
              </div>
              
              <div class="stat-card">
                <div class="stat-icon">ğŸš€</div>
                <div class="stat-content">
                  <div class="stat-number">{{ getCitoyenData()!.nombreProjetsParticipes }}</div>
                  <div class="stat-label">Projets participÃ©s</div>
                </div>
                <div class="stat-badge badge-projets">
                  {{ getCitoyenData()!.nombreProjetsParticipes }}
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Agent Details -->
      <div *ngIf="type === 'agent' && getAgentData()" class="detail-section">
        <div class="detail-card">
          <div class="detail-header">
            <div class="avatar">
              <span>{{ getAgentData()!.prenom.charAt(0) }}{{ getAgentData()!.nom.charAt(0) }}</span>
            </div>
            <div class="header-info">
              <h3>{{ getAgentData()!.prenom }} {{ getAgentData()!.nom }}</h3>
              <p class="subtitle">{{ getAgentData()!.poste }} - {{ getAgentData()!.municipalite }}</p>
              <span class="statut-badge" [ngClass]="getStatutClass(getAgentData()!.statut)">
                {{ getStatutLabel(getAgentData()!.statut) }}
              </span>
            </div>
          </div>
          
          <div class="detail-grid">
            <div class="detail-item">
              <div class="detail-label">ğŸ“§ Email</div>
              <div class="detail-value">{{ getAgentData()!.email }}</div>
            </div>
            
            <div class="detail-item">
              <div class="detail-label">ğŸ“ TÃ©lÃ©phone</div>
              <div class="detail-value">{{ getAgentData()!.telephone }}</div>
            </div>
            
            <div class="detail-item">
              <div class="detail-label">ğŸ›ï¸ MunicipalitÃ©</div>
              <div class="detail-value">{{ getAgentData()!.municipalite }}</div>
            </div>
            
            <div class="detail-item">
              <div class="detail-label">ğŸ’¼ Poste</div>
              <div class="detail-value">{{ getAgentData()!.poste }}</div>
            </div>
            
            <div class="detail-item">
              <div class="detail-label">ğŸ“… Date d'embauche</div>
              <div class="detail-value">{{ formatDate(getAgentData()!.dateEmbauche) }}</div>
            </div>
          </div>
          
          <div class="stats-section">
            <h4>ğŸ“Š Performance</h4>
            <div class="stats-grid">
              <div class="stat-card">
                <div class="stat-icon">ğŸ“</div>
                <div class="stat-content">
                  <div class="stat-number">{{ getAgentData()!.nombreReclamationsTraitees }}</div>
                  <div class="stat-label">RÃ©clamations traitÃ©es</div>
                </div>
                <div class="stat-badge badge-success">
                  {{ getAgentData()!.nombreReclamationsTraitees }}
                </div>
              </div>
              
              <div class="stat-card">
                <div class="stat-icon">â­</div>
                <div class="stat-content">
                  <div class="stat-number">{{ getAgentData()!.noteSatisfaction }}/5</div>
                  <div class="stat-label">Note satisfaction</div>
                </div>
                <div class="note-stars">
                  <span *ngFor="let star of getStars(getAgentData()!.noteSatisfaction)" class="star">{{ star }}</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- MunicipalitÃ© Details -->
      <div *ngIf="type === 'municipalite' && getMunicipaliteData()" class="detail-section">
        <div class="detail-card">
          <div class="detail-header">
            <div class="avatar municipalite-avatar">
              <span>ğŸ›ï¸</span>
            </div>
            <div class="header-info">
              <h3>{{ getMunicipaliteData()!.nom }}</h3>
              <p class="subtitle">{{ getMunicipaliteData()!.region }} - {{ getMunicipaliteData()!.codePostal }}</p>
              <span class="statut-badge" [ngClass]="getStatutClass(getMunicipaliteData()!.statut)">
                {{ getStatutLabel(getMunicipaliteData()!.statut) }}
              </span>
            </div>
          </div>
          
          <div class="detail-grid">
            <div class="detail-item">
              <div class="detail-label">ğŸ›ï¸ Nom</div>
              <div class="detail-value">{{ getMunicipaliteData()!.nom }}</div>
            </div>
            
            <div class="detail-item">
              <div class="detail-label">ğŸ—ºï¸ RÃ©gion</div>
              <div class="detail-value">{{ getMunicipaliteData()!.region }}</div>
            </div>
            
            <div class="detail-item">
              <div class="detail-label">ğŸ“® Code Postal</div>
              <div class="detail-value">{{ getMunicipaliteData()!.codePostal }}</div>
            </div>
            
            <div class="detail-item">
              <div class="detail-label">ğŸ’° Budget Annuel</div>
              <div class="detail-value budget-value">{{ formatCurrency(getMunicipaliteData()!.budgetAnnuel) }}</div>
            </div>
            
            <div class="detail-item">
              <div class="detail-label">ğŸ“… Date de crÃ©ation</div>
              <div class="detail-value">{{ formatDate(getMunicipaliteData()!.dateCreation) }}</div>
            </div>
          </div>
          
          <div class="stats-section">
            <h4>ğŸ“Š Statistiques</h4>
            <div class="stats-grid">
              <div class="stat-card">
                <div class="stat-icon">ğŸ‘¥</div>
                <div class="stat-content">
                  <div class="stat-number">{{ getMunicipaliteData()!.nombreAgents }}</div>
                  <div class="stat-label">Agents</div>
                </div>
                <div class="stat-badge badge-info">
                  {{ getMunicipaliteData()!.nombreAgents }}
                </div>
              </div>
              
              <div class="stat-card">
                <div class="stat-icon">ğŸ‘¤</div>
                <div class="stat-content">
                  <div class="stat-number">{{ getMunicipaliteData()!.nombreCitoyens | number }}</div>
                  <div class="stat-label">Citoyens</div>
                </div>
                <div class="stat-badge badge-primary">
                  {{ getMunicipaliteData()!.nombreCitoyens | number }}
                </div>
              </div>
              
              <div class="stat-card">
                <div class="stat-icon">ğŸš€</div>
                <div class="stat-content">
                  <div class="stat-number">{{ getMunicipaliteData()!.nombreProjets }}</div>
                  <div class="stat-label">Projets</div>
                </div>
                <div class="stat-badge badge-projets">
                  {{ getMunicipaliteData()!.nombreProjets }}
                </div>
              </div>
              
              <div class="stat-card">
                <div class="stat-icon">â­</div>
                <div class="stat-content">
                  <div class="stat-number">{{ getMunicipaliteData()!.tauxSatisfaction }}%</div>
                  <div class="stat-label">Satisfaction</div>
                </div>
                <div class="satisfaction-bar">
                  <div class="satisfaction-fill" [style.width.%]="getMunicipaliteData()!.tauxSatisfaction"></div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal Footer -->
    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="onClose()">
        Fermer
      </button>
    </div>
  </div>
</div>
